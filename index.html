<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Fans</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Importar Chart.js -->
    <style>
        /* Dise침o limpio y ordenado */
        body {
            font-family: Arial, sans-serif;
            background-color: #f9fafb;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: 20px auto;
        }
        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .card h2 {
            margin-bottom: 10px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .stats-card {
            background-color: #e5e7eb;
            padding: 20px;
            border-radius: 8px;
        }
        .stats-container {
            margin-top: 20px;
        }
        /* Estilo para el gr치fico */
        canvas {
            width: 100%;
            height: 400px;
        }
    </style>
</head>
<body>

<!-- T칤tulo de la p치gina -->
<h1 style="text-align: center; padding: 20px; background-color: #4CAF50; color: white;">Registro de Fans</h1>

<div class="container">
    <!-- Formulario de registro de fans -->
    <div class="card">
        <h2>Registrarse</h2>
        <form id="registro-form">
            <input type="text" id="nombre" placeholder="Nombre" required>
            <input type="email" id="correo" placeholder="Correo Electr칩nico" required>
            <input type="text" id="telefono" placeholder="Tel칠fono" required>
            <input type="number" id="edad" placeholder="Edad" required>
            <select id="sexo" required>
                <option value="">Seleccionar Sexo</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
                <option value="Otro">Otro</option>
            </select>
            <input type="text" id="ubicacion" placeholder="Ubicaci칩n" required>
            <button class="btn" type="submit">Registrarse</button>
        </form>
    </div>

    <!-- Contenedor para estad칤sticas visuales -->
    <div class="stats-container">
        <div class="stats-card">
            <h2>游늵 Estad칤sticas</h2>
            <!-- Gr치fico de estad칤sticas -->
            <canvas id="estadisticasChart"></canvas>
        </div>
    </div>
</div>

<script>
    // Configuraci칩n de Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBCunx3qWVfoYj_8Sydwo9uWKLq0DdOj2M",
        authDomain: "lista-de-fans.firebaseapp.com",
        projectId: "lista-de-fans",
        storageBucket: "lista-de-fans.appspot.com",
        messagingSenderId: "842938427785",
        appId: "1:842938427785:web:54c0d314b6d18c8eb29958",
        measurementId: "G-MKXYZLPYF5"
    };
    
    // Inicializa Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // Funci칩n para registrar usuarios
    document.getElementById("registro-form").addEventListener("submit", function (event) {
        event.preventDefault();
        
        const nombre = document.getElementById("nombre").value;
        const correo = document.getElementById("correo").value;
        const telefono = document.getElementById("telefono").value;
        const edad = document.getElementById("edad").value;
        const sexo = document.getElementById("sexo").value;
        const ubicacion = document.getElementById("ubicacion").value;

        // Validaci칩n del tel칠fono (al menos 10 d칤gitos)
        if (telefono.length < 10) {
            Swal.fire("Error", "El tel칠fono no es v치lido.", "error");
            return;
        }

        // Guardar en Firestore
        db.collection("fans").add({
            nombre,
            correo,
            telefono,
            edad,
            sexo,
            ubicacion
        })
        .then(() => {
            Swal.fire("칄xito", "춰Te has registrado correctamente!", "success");
            mostrarEstadisticas(); // Mostrar estad칤sticas
            document.getElementById("registro-form").reset();
        })
        .catch((error) => {
            console.error("Error al registrar: ", error);
        });
    });

    // Funci칩n para mostrar estad칤sticas con Chart.js
    async function mostrarEstadisticas() {
        const fanRef = db.collection("fans");
        const snapshot = await fanRef.get();
        const fans = snapshot.docs.map(doc => doc.data());

        const totalFans = fans.length;
        let fansPorUbicacion = {};
        let fansPorEdad = {};

        // Calcular estad칤sticas por ubicaci칩n
        fans.forEach(fan => {
            const ubicacion = fan.ubicacion;
            fansPorUbicacion[ubicacion] = (fansPorUbicacion[ubicacion] || 0) + 1;
        });

        // Calcular estad칤sticas por edad
        fans.forEach(fan => {
            const edad = fan.edad;
            fansPorEdad[edad] = (fansPorEdad[edad] || 0) + 1;
        });

        // Mostrar las estad칤sticas visualmente
        const ubicaciones = Object.keys(fansPorUbicacion);
        const edades = Object.keys(fansPorEdad);
        
        // Crear los gr치ficos con Chart.js
        const ctx = document.getElementById('estadisticasChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',  // Gr치fico de barras
            data: {
                labels: [...ubicaciones, ...edades], // Unimos las ubicaciones y edades
                datasets: [{
                    label: 'Fans por Ubicaci칩n y Edad',
                    data: [...Object.values(fansPorUbicacion), ...Object.values(fansPorEdad)],
                    backgroundColor: '#4CAF50',
                    borderColor: '#388E3C',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Mostrar estad칤sticas b치sicas
        document.getElementById("estadisticasTotal").innerText = `Total de Fans: ${totalFans}`;
        document.getElementById("estadisticasUbicacion").innerText = `Fans por Ubicaci칩n: ${JSON.stringify(fansPorUbicacion)}`;
        document.getElementById("estadisticasEdad").innerText = `Fans por Edad: ${JSON.stringify(fansPorEdad)}`;
    }

    // Llamar a la funci칩n de estad칤sticas al cargar la app
    mostrarEstadisticas();
</script>

</body>
</html>
